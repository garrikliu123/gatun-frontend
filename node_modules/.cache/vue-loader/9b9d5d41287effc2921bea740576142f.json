{"remainingRequest":"/Users/xiangliu/Development/Projects/xxx/apera-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xiangliu/Development/Projects/xxx/apera-frontend/src/views/Manage/AddTopicDialog.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/xiangliu/Development/Projects/xxx/apera-frontend/src/views/Manage/AddTopicDialog.vue","mtime":1586194471887},{"path":"/Users/xiangliu/Development/Projects/xxx/apera-frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/xiangliu/Development/Projects/xxx/apera-frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/xiangliu/Development/Projects/xxx/apera-frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/xiangliu/Development/Projects/xxx/apera-frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHY0IGFzIHV1aWR2NCB9IGZyb20gInV1aWQiOwppbXBvcnQgeyBtYXBHZXR0ZXJzLCBtYXBBY3Rpb25zIH0gZnJvbSAidnVleCI7CmltcG9ydCB7IHVwbG9hZEltYWdlIH0gZnJvbSAiYXBpL2NvbW1vbiI7CmltcG9ydCB0b3BpY0FwaSBmcm9tICJhcGkvdG9waWMiOwppbXBvcnQgdG9waWNDb25maWcgZnJvbSAiLi9jb25maWcvdG9waWNfY29uZmlnLmpzIjsKaW1wb3J0IHRvcGljVGFibGVDb25maWcgZnJvbSAiLi9jb25maWcvdG9waWNfdGFibGVfY29uZmlnLmpzIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBwcm9wczogewogICAgbW9kZTogewogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgIH0sCiAgICB0YXJnZXRUb3BpYzogewogICAgICB0eXBlOiBPYmplY3QsCiAgICAgIGRlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0sCiAgICB9LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHRvcGljQ29uZmlnLAogICAgICB0b3BpY1RhYmxlQ29uZmlnLAogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwKICAgICAgZm9ybURhdGE6IHsKICAgICAgICB0b3BpY05hbWU6ICIiLAogICAgICAgIHRvcGljVHlwZTogdG9waWNUYWJsZUNvbmZpZy50eXBlT3B0aW9uc1swXS52YWx1ZSwKICAgICAgICB0b3BpY0ltYWdlOiAiIiwKICAgICAgICBjYXRlZ29yeUxpc3Q6IFtdLAogICAgICB9LAogICAgICBmb3JtUnVsZXM6IHsKICAgICAgICB0b3BpY05hbWU6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6ICJQbGVhc2UgZW50ZXIgYSB2YWxpZCBuYW1lIiwKICAgICAgICAgICAgdHJpZ2dlcjogImJsdXIiLAogICAgICAgICAgfSwKICAgICAgICBdLAogICAgICAgIGNhdGVnb3J5TGlzdDogWwogICAgICAgICAgewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogIlBsZWFzZSBzZWxlY3QgYSBjYXRlZ29yeSIsCiAgICAgICAgICAgIHRyaWdnZXI6ICJibHVyIiwKICAgICAgICAgIH0sCiAgICAgICAgXSwKICAgICAgfSwKICAgICAgZm9ybUxhYmVsV2lkdGg6ICIxMDBweCIsCiAgICB9OwogIH0sCgogIGNvbXB1dGVkOiB7CiAgICBtYXRjaGVkQ2F0ZWdvcnlMaXN0KCkgewogICAgICBjb25zdCByZXN1bHQgPSBbXTsKICAgICAgdGhpcy5jYXRlZ29yeUxpc3QuZm9yRWFjaCgoaXRlbSkgPT4gewogICAgICAgIGlmIChpdGVtLmNhdGVnb3J5VHlwZSA9PT0gdGhpcy5mb3JtRGF0YS50b3BpY1R5cGUpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKHsKICAgICAgICAgICAgbGFiZWw6IGl0ZW0uY2F0ZWdvcnlOYW1lLAogICAgICAgICAgICB2YWx1ZTogaXRlbS5jYXRlZ29yeUlkLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0sCiAgICAuLi5tYXBHZXR0ZXJzKFsiY2F0ZWdvcnlMaXN0Il0pLAogIH0sCgogIHdhdGNoOiB7CiAgICB0YXJnZXRUb3BpYyh0b3BpYykgewogICAgICBpZiAodG9waWMpIHsKICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuZm9ybURhdGEsIHRvcGljKTsKICAgICAgfQogICAgfSwKICAgICJmb3JtRGF0YS50b3BpY1R5cGUiKCkgewogICAgICBpZiAodGhpcy5tb2RlID09IHRvcGljQ29uZmlnLk1PREUuTkVXKSB7CiAgICAgICAgdGhpcy5mb3JtRGF0YS5jYXRlZ29yeUxpc3QgPSBbXTsKICAgICAgfQogICAgfSwKICB9LAoKICBtZXRob2RzOiB7CiAgICBvblN1Ym1pdENsaWNrKCkgewogICAgICB0aGlzLiRyZWZzLmVkaXRUb3BpY0Zvcm0udmFsaWRhdGUoKHZhbGlkKSA9PiB7CiAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICBpZiAodGhpcy5tb2RlID09PSB0b3BpY0NvbmZpZy5NT0RFLk5FVykgewogICAgICAgICAgICBjb25zdCB0b3BpY0lkID0gdXVpZHY0KCk7CiAgICAgICAgICAgIHRoaXMuZm9ybURhdGEudG9waWNJZCA9IHRvcGljSWQ7CiAgICAgICAgICAgIHRvcGljQXBpLmFkZFRvcGljKHRoaXMuZm9ybURhdGEpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuZ2V0VG9waWNMaXN0KCk7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICBtZXNzYWdlOiAiQWRkIFRvcGljIFN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5tb2RlID09PSB0b3BpY0NvbmZpZy5NT0RFLkVESVQpIHsKICAgICAgICAgICAgdG9waWNBcGkudXBkYXRlVG9waWModGhpcy5mb3JtRGF0YSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy5nZXRUb3BpY0xpc3QoKTsKICAgICAgICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJVcGRhdGUgVG9waWMgU3VjY2VzcyIsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIG9uVXBsb2FkSW1hZ2UocmVxKSB7CiAgICAgIGxldCBmaWxldHlwZSA9ICIiOwogICAgICBpZiAocmVxLmZpbGUudHlwZSA9PT0gImltYWdlL3BuZyIpIHsKICAgICAgICBmaWxldHlwZSA9ICJwbmciOwogICAgICB9IGVsc2UgewogICAgICAgIGZpbGV0eXBlID0gImpwZyI7CiAgICAgIH0KCiAgICAgIC8vIOmHjeWRveWQjeimgeS4iuS8oOeahOaWh+S7tgogICAgICBjb25zdCBmaWxlbmFtZSA9IHV1aWR2NCgpICsgIi4iICsgZmlsZXR5cGU7CgogICAgICBjb25zdCBmb3JtZGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoKICAgICAgZm9ybWRhdGEuYXBwZW5kKCJmaWxlIiwgcmVxLmZpbGUpOwoKICAgICAgdXBsb2FkSW1hZ2UoCiAgICAgICAgZmlsZW5hbWUsCiAgICAgICAgZm9ybWRhdGEsCiAgICAgICAgewogICAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogIm11bHRpcGFydC9mb3JtLWRhdGEiIH0sCiAgICAgICAgfSwKICAgICAgICAoaW1hZ2UpID0+IHsKICAgICAgICAgIGlmIChpbWFnZS51cmwpIHsKICAgICAgICAgICAgdGhpcy5mb3JtRGF0YS50b3BpY0ltYWdlID0gaW1hZ2UudXJsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgKTsKICAgIH0sCgogICAgLy8g6aqM6K+B5paH5Lu25ZCI5rOV5oCnCiAgICBiZWZvcmVVcGxvYWQoZmlsZSkgewogICAgICBjb25zdCBpc0pQRyA9IGZpbGUudHlwZSA9PT0gImltYWdlL2pwZWciIHx8IGZpbGUudHlwZSA9PT0gImltYWdlL3BuZyI7CiAgICAgIGNvbnN0IGlzTHQyTSA9IGZpbGUuc2l6ZSAvIDEwMjQgLyAxMDI0IDwgNTsKCiAgICAgIGlmICghaXNKUEcpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCJJbWFnZSB0eXBlIHNob3VsZCBiZSBKUEVEIG9yIFBORyIpOwogICAgICB9CgogICAgICBpZiAoIWlzTHQyTSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIkltYWdlIHNpemUgc2hvdWxkIGxlc3MgdGhhbiA1TUIiKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGlzSlBHICYmIGlzTHQyTTsKICAgIH0sCgogICAgb25VcGxvYWRTdWNjZXNzKCkge30sCgogICAgLi4ubWFwQWN0aW9ucyhbImdldFRvcGljTGlzdCJdKSwKICB9LAp9Owo="},{"version":3,"sources":["AddTopicDialog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2DA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA","file":"AddTopicDialog.vue","sourceRoot":"src/views/Manage","sourcesContent":["<template>\n  <el-dialog class=\"ap-dialog\" title=\"Edit Topic\" :visible.sync=\"dialogVisible\" width=\"1100px\">\n    <div class=\"dialog-inner\">\n      <el-form :model=\"formData\" :rules=\"formRules\" ref=\"editTopicForm\">\n        <!-- Name -->\n        <el-form-item label=\"Name\" :label-width=\"formLabelWidth\" prop=\"topicName\">\n          <el-input v-model=\"formData.topicName\"></el-input>\n        </el-form-item>\n\n        <!-- Type -->\n        <el-form-item label=\"Type\" :label-width=\"formLabelWidth\">\n          <el-select\n            class=\"form-item\"\n            v-model=\"formData.topicType\"\n            placeholder=\"Select the type\"\n            :disabled=\"mode == topicConfig.MODE.EDIT\"\n          >\n            <el-option\n              v-for=\"item in topicTableConfig.typeOptions\"\n              :key=\"item.value\"\n              :label=\"item.label\"\n              :value=\"item.value\"\n            ></el-option>\n          </el-select>\n        </el-form-item>\n\n        <!-- Category -->\n        <el-form-item label=\"Category\" :label-width=\"formLabelWidth\" prop=\"categoryList\">\n          <el-select class=\"form-item\" v-model=\"formData.categoryList\" filterable multiple>\n            <el-option\n              v-for=\"item in matchedCategoryList\"\n              :key=\"item.value\"\n              :label=\"item.label\"\n              :value=\"item.value\"\n            ></el-option>\n          </el-select>\n        </el-form-item>\n\n        <!-- Pictures -->\n        <el-upload\n          class=\"avatar-uploader\"\n          action=\"\"\n          :show-file-list=\"false\"\n          :http-request=\"onUploadImage\"\n          :before-upload=\"beforeUpload\"\n          :on-success=\"onUploadSuccess\"\n        >\n          <img v-if=\"formData.topicImage\" :src=\"formData.topicImage\" class=\"avatar\" />\n          <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\n        </el-upload>\n      </el-form>\n    </div>\n    <div slot=\"footer\" class=\"dialog-footer\">\n      <el-button @click=\"dialogVisible = false\">Cancel</el-button>\n      <el-button type=\"primary\" @click=\"onSubmitClick\">Submit</el-button>\n    </div>\n  </el-dialog>\n</template>\n<script>\nimport { v4 as uuidv4 } from \"uuid\";\nimport { mapGetters, mapActions } from \"vuex\";\nimport { uploadImage } from \"api/common\";\nimport topicApi from \"api/topic\";\nimport topicConfig from \"./config/topic_config.js\";\nimport topicTableConfig from \"./config/topic_table_config.js\";\n\nexport default {\n  props: {\n    mode: {\n      required: true,\n    },\n    targetTopic: {\n      type: Object,\n      default() {\n        return null;\n      },\n    },\n  },\n  data() {\n    return {\n      topicConfig,\n      topicTableConfig,\n      dialogVisible: false,\n      formData: {\n        topicName: \"\",\n        topicType: topicTableConfig.typeOptions[0].value,\n        topicImage: \"\",\n        categoryList: [],\n      },\n      formRules: {\n        topicName: [\n          {\n            required: true,\n            message: \"Please enter a valid name\",\n            trigger: \"blur\",\n          },\n        ],\n        categoryList: [\n          {\n            required: true,\n            message: \"Please select a category\",\n            trigger: \"blur\",\n          },\n        ],\n      },\n      formLabelWidth: \"100px\",\n    };\n  },\n\n  computed: {\n    matchedCategoryList() {\n      const result = [];\n      this.categoryList.forEach((item) => {\n        if (item.categoryType === this.formData.topicType) {\n          result.push({\n            label: item.categoryName,\n            value: item.categoryId,\n          });\n        }\n      });\n      return result;\n    },\n    ...mapGetters([\"categoryList\"]),\n  },\n\n  watch: {\n    targetTopic(topic) {\n      if (topic) {\n        Object.assign(this.formData, topic);\n      }\n    },\n    \"formData.topicType\"() {\n      if (this.mode == topicConfig.MODE.NEW) {\n        this.formData.categoryList = [];\n      }\n    },\n  },\n\n  methods: {\n    onSubmitClick() {\n      this.$refs.editTopicForm.validate((valid) => {\n        if (valid) {\n          if (this.mode === topicConfig.MODE.NEW) {\n            const topicId = uuidv4();\n            this.formData.topicId = topicId;\n            topicApi.addTopic(this.formData).then((res) => {\n              this.dialogVisible = false;\n              this.getTopicList();\n              if (res.success) {\n                this.$message({\n                  type: \"success\",\n                  message: \"Add Topic Success\",\n                });\n              }\n            });\n          } else if (this.mode === topicConfig.MODE.EDIT) {\n            topicApi.updateTopic(this.formData).then((res) => {\n              this.dialogVisible = false;\n              this.getTopicList();\n              if (res.success) {\n                this.$message({\n                  type: \"success\",\n                  message: \"Update Topic Success\",\n                });\n              }\n            });\n          }\n        }\n      });\n    },\n\n    onUploadImage(req) {\n      let filetype = \"\";\n      if (req.file.type === \"image/png\") {\n        filetype = \"png\";\n      } else {\n        filetype = \"jpg\";\n      }\n\n      // 重命名要上传的文件\n      const filename = uuidv4() + \".\" + filetype;\n\n      const formdata = new FormData();\n\n      formdata.append(\"file\", req.file);\n\n      uploadImage(\n        filename,\n        formdata,\n        {\n          headers: { \"Content-Type\": \"multipart/form-data\" },\n        },\n        (image) => {\n          if (image.url) {\n            this.formData.topicImage = image.url;\n          }\n        }\n      );\n    },\n\n    // 验证文件合法性\n    beforeUpload(file) {\n      const isJPG = file.type === \"image/jpeg\" || file.type === \"image/png\";\n      const isLt2M = file.size / 1024 / 1024 < 5;\n\n      if (!isJPG) {\n        this.$message.error(\"Image type should be JPED or PNG\");\n      }\n\n      if (!isLt2M) {\n        this.$message.error(\"Image size should less than 5MB\");\n      }\n\n      return isJPG && isLt2M;\n    },\n\n    onUploadSuccess() {},\n\n    ...mapActions([\"getTopicList\"]),\n  },\n};\n</script>\n<style lang=\"less\">\n.ap-dialog {\n  overflow-x: visible;\n  .dialog-inner {\n    max-height: 60vh;\n    overflow-x: visible;\n    overflow-y: auto;\n    padding: 0 20px;\n  }\n\n  .form-item {\n    width: 100%;\n  }\n\n  .avatar-uploader .el-upload {\n    border: 1px dashed #d9d9d9;\n    border-radius: 6px;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n  }\n  .avatar-uploader .el-upload:hover {\n    border-color: #409eff;\n  }\n  .avatar-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 400px;\n    height: 180px;\n    line-height: 178px;\n    text-align: center;\n  }\n  .avatar {\n    height: 180px;\n    display: block;\n  }\n}\n</style>\n"]}]}